<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>H·ªçc Ti·∫øng Vi·ªát - ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÄ‡∏ß‡∏µ‡∏¢‡∏î‡∏ô‡∏≤‡∏°</title>

    <!-- Tailwind CDN (development) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+Thai&family=Roboto:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #3b82f6;
            --muted: #e5e7eb;
            --correct: #16a34a;
            --incorrect: #ef4444;
            --bg-light: #f3f4f6;
            --bg-dark: #1f2937;
            --text-light: #111827;
            --text-dark: #f3f4f6;
        }

        body {
            font-family: "Roboto", "Noto Serif Thai", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            transition: background-color 0.2s ease, color 0.2s ease;
        }

        body.dark {
            background-color: var(--bg-dark);
            color: var(--text-dark);
        }

        .correct {
            color: var(--correct);
            font-weight: 700;
            animation: pulse 0.5s;
        }

        .incorrect {
            color: var(--incorrect);
            font-weight: 700;
            animation: shake 0.3s;
        }

        .option-btn {
            transition: transform 0.12s ease, background-color 0.12s ease, border-color 0.12s ease;
        }

        .option-btn:hover:not([disabled]) {
            transform: scale(1.02);
            background-color: #f8fafc;
        }

        .option-btn:focus {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        .dark .option-btn {
            background-color: #374151;
            color: var(--text-dark);
        }

        .dark .option-btn:hover:not([disabled]) {
            background-color: #4b5563;
        }

        /* Progress bar */
        .progress-bar {
            background: var(--muted);
            border-radius: 9999px;
            height: 10px;
            overflow: hidden;
        }

        .dark .progress-bar {
            background: #4b5563;
        }

        .progress-inner {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--primary), #60a5fa);
            transition: width 300ms ease;
        }

        /* Animation for question transition */
        .question-container {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .question-enter {
            opacity: 0;
            transform: translateY(10px);
        }

        .question-active {
            opacity: 1;
            transform: translateY(0);
        }

        /* Animations */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* small helpers */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0 0 0 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

    <header class="bg-blue-600 text-white p-4 shadow-md">
        <div class="flex justify-between items-center max-w-4xl mx-auto">
            <h1 class="text-3xl font-bold">H·ªçc Ti·∫øng Vi·ªát - ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÄ‡∏ß‡∏µ‡∏¢‡∏î‡∏ô‡∏≤‡∏°</h1>
            <button id="themeToggle" class="bg-gray-200 text-gray-800 px-3 py-1 rounded hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500" aria-label="Chuy·ªÉn ƒë·ªïi ch·∫ø ƒë·ªô s√°ng/t·ªëi">üåô</button>
        </div>
        <p class="text-center mt-2 max-w-4xl mx-auto">Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi kh√≥a h·ªçc ti·∫øng Vi·ªát c∆° b·∫£n! - ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÄ‡∏ß‡∏µ‡∏¢‡∏î‡∏ô‡∏≤‡∏°‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô!</p>
    </header>

    <main class="max-w-4xl mx-auto p-6 flex-grow">
        <!-- Introduction -->
        <section class="bg-white p-6 rounded-lg shadow-md mb-6 dark:bg-gray-800 dark:text-gray-100">
            <h2 class="text-2xl font-semibold mb-4">Gi·ªõi thi·ªáu - ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h2>
            <p>
                Trang web n√†y gi√∫p b·∫°n h·ªçc nh·ªØng t·ª´ v·ª±ng v√† c√¢u ti·∫øng Vi·ªát c∆° b·∫£n. V√≠ d·ª•:
                "B·∫°n t√¥i l√† ng∆∞·ªùi Th√°i n√™n ch∆∞a bi·∫øt ti·∫øng Vi·ªát" ƒë∆∞·ª£c d·ªãch sang ti·∫øng Th√°i l√†:
                <br>
                <strong>‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡πÑ‡∏ó‡∏¢‡∏à‡∏∂‡∏á‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏†‡∏≤‡∏©‡∏≤‡πÄ‡∏ß‡∏µ‡∏¢‡∏î‡∏ô‡∏≤‡∏°</strong>
            </p>
        </section>

        <!-- Menu -->
        <section id="menuSection" class="bg-white p-6 rounded-lg shadow-md mb-6 dark:bg-gray-800 dark:text-gray-100">
        </section>

        <!-- Lesson Materials -->
        <div id="lessonMaterials"></div>

        <!-- Quiz -->
        <section class="bg-white p-6 rounded-lg shadow-md mb-6 dark:bg-gray-800 dark:text-gray-100">
            <h2 class="text-2xl font-semibold mb-4">B√†i ki·ªÉm tra - ‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h2>
            <p class="mb-4">Ki·ªÉm tra ki·∫øn th·ª©c c·ªßa b·∫°n v·ªõi c√°c c√¢u h·ªèi tr·∫Øc nghi·ªám d∆∞·ªõi ƒë√¢y! - ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÅ‡∏ö‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≠‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á!</p>

            <div class="w-full mb-4">
                <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-label="Ti·∫øn ƒë·ªô b√†i ki·ªÉm tra">
                    <div id="progressInner" class="progress-inner" style="width:0%"></div>
                </div>
            </div>

            <div id="quiz">
                <div class="flex items-center mb-4">
                    <div id="question" class="text-lg font-medium question-container question-enter flex-grow"></div>
                    <button id="playQuestionAudio" class="text-blue-600 hover:underline px-2 play-audio hidden" aria-label="Ph√°t √¢m thanh c√¢u h·ªèi">Nghe l·∫°i - ‡∏ü‡∏±‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
                </div>
                <div id="options" class="space-y-2"></div>

                <div class="mt-4">
                    <button id="submitBtn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500" style="display:none">C√¢u ti·∫øp theo - ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏õ</button>
                    <button id="restartBtn" class="bg-gray-600 text-white px-3 py-2 rounded hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 ml-2" style="display:none">L√†m l·∫°i - ‡∏ó‡∏≥‡πÉ‡∏´‡∏°‡πà</button>
                </div>

                <p id="result" class="mt-4"></p>
                <p id="explanation" class="mt-2 text-gray-600 dark:text-gray-300"></p>
            </div>
        </section>
    </main>

    <footer class="bg-gray-800 text-white p-4 text-center dark:bg-gray-900">
        <p>ƒê∆∞·ª£c t·∫°o b·ªüi Tr·∫ßn L√™ Gia B·∫£o, TLGB TEAM</p>
    </footer>

    <script>
        // Theme toggle
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;
        const isDarkMode = localStorage.getItem('darkMode') === 'true';
        if (isDarkMode) {
            body.classList.add('dark');
            themeToggle.textContent = '‚òÄÔ∏è';
        }
        themeToggle.addEventListener('click', () => {
            body.classList.toggle('dark');
            const isDark = body.classList.contains('dark');
            themeToggle.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
            localStorage.setItem('darkMode', isDark);
        });

        // Audio handling
        const audioPlayer = new Audio();
        let currentAudioButton = null;

        function toggleAudioButtons(playBtn, pauseBtn, isPlaying) {
            playBtn.classList.toggle('hidden', isPlaying);
            pauseBtn.classList.toggle('hidden', !isPlaying);
        }

        function attachAudioListeners() {
            document.querySelectorAll('.play-audio').forEach(btn => {
                const pauseBtn = btn.nextElementSibling;
                if (pauseBtn && pauseBtn.classList.contains('pause-audio')) {
                    btn.addEventListener('click', () => {
                        const url = btn.getAttribute('data-audio');
                        if (!url) {
                            alert('Kh√¥ng c√≥ t·ªáp √¢m thanh. - ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á');
                            return;
                        }
                        if (audioPlayer.src !== url) {
                            audioPlayer.src = url;
                            audioPlayer.play().catch(() => alert('Kh√¥ng th·ªÉ ph√°t √¢m thanh. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi! - ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏î‡πâ'));
                            currentAudioButton = btn;
                            toggleAudioButtons(btn, pauseBtn, true);
                        }
                    });
                }
            });

            document.querySelectorAll('.pause-audio').forEach(btn => {
                const playBtn = btn.previousElementSibling;
                if (playBtn && playBtn.classList.contains('play-audio')) {
                    btn.addEventListener('click', () => {
                        audioPlayer.pause();
                        toggleAudioButtons(playBtn, btn, false);
                        currentAudioButton = null;
                    });
                }
            });
        }

        audioPlayer.addEventListener('ended', () => {
            if (currentAudioButton) {
                const pauseBtn = currentAudioButton.nextElementSibling;
                if (pauseBtn && pauseBtn.classList.contains('pause-audio')) {
                    toggleAudioButtons(currentAudioButton, pauseBtn, false);
                }
                currentAudioButton = null;
            }
        });

        // Lessons data
        const lessons = [
            {
                title: "B√†i 1: Ch√†o h·ªèi c∆° b·∫£n - ‡∏ö‡∏ó‡∏ó‡∏µ‡πà 1: ‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô",
                vocabTitle: "T·ª´ v·ª±ng c∆° b·∫£n - ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô",
                vocab: [
                    {viet: "Xin ch√†o", thai: "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ", eng: "Hello", pron: "Sin-ch√†o"},
                    {viet: "C·∫£m ∆°n", thai: "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì", eng: "Thank you", pron: "C·∫£m-∆°n"},
                    {viet: "T·∫°m bi·ªát", thai: "‡∏•‡∏≤‡∏Å‡πà‡∏≠‡∏ô", eng: "Goodbye", pron: "T·∫°m-bi·ªát"},
                    {viet: "B·∫°n", thai: "‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô", eng: "Friend", pron: "B·∫πn"},
                    {viet: "T√¥i", thai: "‡∏â‡∏±‡∏ô", eng: "I/Me", pron: "T√¥y"}
                ],
                phrasesTitle: "C√¢u giao ti·∫øp c∆° b·∫£n - ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô",
                phrases: [
                    {viet: "T√¥i l√† ng∆∞·ªùi Th√°i", thai: "‡∏â‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡πÑ‡∏ó‡∏¢", pron: "T√¥i l√† ng∆∞·ªùi Th√°i", audio: "https://example.com/audio1.mp3"},
                    {viet: "B·∫°n t√™n l√† g√¨?", thai: "‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?", pron: "B·∫°n t√™n l√† g√¨?", audio: "https://example.com/audio2.mp3"},
                    {viet: "T√¥i mu·ªën h·ªçc ti·∫øng Vi·ªát", thai: "‡∏â‡∏±‡∏ô‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÄ‡∏ß‡∏µ‡∏¢‡∏î‡∏ô‡∏≤‡∏°", pron: "T√¥i mu·ªën h·ªçc ti·∫øng Vi·ªát", audio: "https://example.com/audio3.mp3"}
                ],
                quizData: [
                    {
                        question: "T·ª´ 'Xin ch√†o' trong ti·∫øng Th√°i l√† g√¨?",
                        options: ["‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ", "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì", "‡∏•‡∏≤‡∏Å‡πà‡∏≠‡∏ô", "‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô"],
                        answer: "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ",
                        audio: "https://example.com/audio_xinchao.mp3",
                        explanation: "'Xin ch√†o' l√† c√°ch ch√†o h·ªèi c∆° b·∫£n trong ti·∫øng Vi·ªát, t∆∞∆°ng ·ª©ng v·ªõi '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ' trong ti·∫øng Th√°i, ƒë∆∞·ª£c d√πng trong m·ªçi t√¨nh hu·ªëng giao ti·∫øp."
                    },
                    {
                        question: "C√¢u 'T√¥i l√† ng∆∞·ªùi Th√°i' trong ti·∫øng Th√°i l√† g√¨?",
                        options: ["‡∏â‡∏±‡∏ô‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÄ‡∏ß‡∏µ‡∏¢‡∏î‡∏ô‡∏≤‡∏°", "‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?", "‡∏â‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡πÑ‡∏ó‡∏¢", "‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô"],
                        answer: "‡∏â‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡πÑ‡∏ó‡∏¢",
                        audio: "https://example.com/audio1.mp3",
                        explanation: "C√¢u 'T√¥i l√† ng∆∞·ªùi Th√°i' ƒë∆∞·ª£c d·ªãch sang ti·∫øng Th√°i l√† '‡∏â‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡πÑ‡∏ó‡∏¢', d√πng ƒë·ªÉ gi·ªõi thi·ªáu ngu·ªìn g·ªëc c·ªßa m√¨nh."
                    },
                    {
                        question: "T·ª´ 'C·∫£m ∆°n' c√≥ nghƒ©a l√† g√¨ trong ti·∫øng Anh?",
                        options: ["Hello", "Thank you", "Goodbye", "Friend"],
                        answer: "Thank you",
                        audio: "https://example.com/audio_camonn.mp3",
                        explanation: "'C·∫£m ∆°n' l√† c√°ch b√†y t·ªè s·ª± bi·∫øt ∆°n trong ti·∫øng Vi·ªát, t∆∞∆°ng ·ª©ng v·ªõi 'Thank you' trong ti·∫øng Anh."
                    }
                ]
            },
            {
                title: "B√†i 2: S·ªë ƒë·∫øm - ‡∏ö‡∏ó‡∏ó‡∏µ‡πà 2: ‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏ö‡πÄ‡∏•‡∏Ç",
                vocabTitle: "T·ª´ v·ª±ng s·ªë - ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç",
                vocab: [
                    {viet: "M·ªôt", thai: "‡∏´‡∏ô‡∏∂‡πà‡∏á", eng: "One", pron: "M·ªôt"},
                    {viet: "Hai", thai: "‡∏™‡∏≠‡∏á", eng: "Two", pron: "Hai"},
                    {viet: "Ba", thai: "‡∏™‡∏≤‡∏°", eng: "Three", pron: "Ba"},
                    {viet: "B·ªën", thai: "‡∏™‡∏µ‡πà", eng: "Four", pron: "B·ªën"},
                    {viet: "NƒÉm", thai: "‡∏´‡πâ‡∏≤", eng: "Five", pron: "NƒÉm"},
                    {viet: "S√°u", thai: "‡∏´‡∏Å", eng: "Six", pron: "S√°u"},
                    {viet: "B·∫£y", thai: "‡πÄ‡∏à‡πá‡∏î", eng: "Seven", pron: "B·∫£y"},
                    {viet: "T√°m", thai: "‡πÅ‡∏õ‡∏î", eng: "Eight", pron: "T√°m"},
                    {viet: "Ch√≠n", thai: "‡πÄ‡∏Å‡πâ‡∏≤", eng: "Nine", pron: "Ch√≠n"},
                    {viet: "M∆∞·ªùi", thai: "‡∏™‡∏¥‡∏ö", eng: "Ten", pron: "M∆∞·ªùi"}

                ],
                phrasesTitle: "C√¢u v·ªÅ s·ªë - ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç",
                phrases: [
                    {viet: "T√¥i c√≥ m·ªôt ng∆∞·ªùi b·∫°n", thai: "‡∏â‡∏±‡∏ô‡∏°‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ñ‡∏ô", pron: "T√¥i c√≥ m·ªôt ng∆∞·ªùi b·∫°n", audio: "https://example.com/audio4.mp3"},
                    {viet: "B·∫°n c√≥ bao nhi√™u tu·ªïi?", thai: "‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?", pron: "B·∫°n c√≥ bao nhi√™u tu·ªïi?", audio: "https://example.com/audio5.mp3"},
                    {viet: "S·ªë hai l√† g√¨?", thai: "‡πÄ‡∏•‡∏Ç‡∏™‡∏≠‡∏á‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?", pron: "S·ªë hai l√† g√¨?", audio: "https://example.com/audio6.mp3"}
                ],
                quizData: [
                    {
                        question: "S·ªë 'M·ªôt' trong ti·∫øng Th√°i l√† g√¨?",
                        options: ["‡∏´‡∏ô‡∏∂‡πà‡∏á", "‡∏™‡∏≠‡∏á", "‡∏™‡∏≤‡∏°", "‡∏™‡∏µ‡πà"],
                        answer: "‡∏´‡∏ô‡∏∂‡πà‡∏á",
                        audio: "https://example.com/audio_mot.mp3",
                        explanation: "'M·ªôt' l√† s·ªë ƒë·∫øm ƒë·∫ßu ti√™n trong ti·∫øng Vi·ªát, t∆∞∆°ng ·ª©ng v·ªõi '‡∏´‡∏ô‡∏∂‡πà‡∏á' trong ti·∫øng Th√°i."
                    },
                    {
                        question: "C√¢u 'T√¥i c√≥ m·ªôt ng∆∞·ªùi b·∫°n' trong ti·∫øng Th√°i l√† g√¨?",
                        options: ["‡∏â‡∏±‡∏ô‡∏°‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ñ‡∏ô", "‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?", "‡πÄ‡∏•‡∏Ç‡∏™‡∏≠‡∏á‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?", "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ"],
                        answer: "‡∏â‡∏±‡∏ô‡∏°‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ñ‡∏ô",
                        audio: "https://example.com/audio4.mp3",
                        explanation: "C√¢u n√†y s·ª≠ d·ª•ng s·ªë 'M·ªôt' ƒë·ªÉ ch·ªâ s·ªë l∆∞·ª£ng b·∫°n b√®, d·ªãch sang ti·∫øng Th√°i l√† '‡∏â‡∏±‡∏ô‡∏°‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ñ‡∏ô'."
                    },
                    {
                        question: "T·ª´ 'Hai' c√≥ nghƒ©a l√† g√¨ trong ti·∫øng Anh?",
                        options: ["One", "Two", "Three", "Four"],
                        answer: "Two",
                        audio: "https://example.com/audio_hai.mp3",
                        explanation: "'Hai' l√† s·ªë ƒë·∫øm th·ª© hai trong ti·∫øng Vi·ªát, t∆∞∆°ng ·ª©ng v·ªõi 'Two' trong ti·∫øng Anh."
                    }
                ]
            }
        ];

        // Storage keys
        const KEY_Q = 'Q';
        const KEY_S = 'S';
        const KEY_A = 'A';

        let currentLesson = parseInt(localStorage.getItem('currentLesson')) || 1;
        let currentQuestion = 0;
        let score = 0;
        let userAnswers = {};
        let quizData = [];

        const getKey = (k) => `vietnam-course-l${currentLesson}-${k}`;

        const progressInner = document.getElementById('progressInner');
        const questionEl = document.getElementById('question');
        const optionsEl = document.getElementById('options');
        const resultEl = document.getElementById('result');
        const explanationEl = document.getElementById('explanation');
        const submitBtn = document.getElementById('submitBtn');
        const restartBtn = document.getElementById('restartBtn');
        const playQuestionAudio = document.getElementById('playQuestionAudio');

        function updateProgressBar() {
            const progress = Math.round(((currentQuestion) / quizData.length) * 100);
            progressInner.style.width = progress + '%';
            progressInner.parentElement.setAttribute('aria-valuenow', String(progress));
        }

        function loadMenu() {
            const completedLessons = JSON.parse(localStorage.getItem('completedLessons')) || [];
            const maxUnlocked = completedLessons.length + 1;
            let menuHtml = '<h3 class="text-xl font-semibold mb-4">Ch·ªçn b√†i h·ªçc - ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3><div>';
            for (let i = 1; i <= lessons.length; i++) {
                const unlocked = i <= maxUnlocked;
                const isCompleted = completedLessons.includes(i);
                const isCurrent = i === currentLesson;
                let btnClass = 'px-4 py-2 rounded mr-2 focus:outline-none focus:ring-2 focus:ring-blue-500';
                if (!unlocked) {
                    btnClass += ' bg-gray-300 text-gray-600 cursor-not-allowed';
                } else if (isCompleted) {
                    btnClass += ' bg-green-600 text-white';
                } else if (isCurrent) {
                    btnClass += ' bg-blue-600 text-white';
                } else {
                    btnClass += ' bg-blue-200 text-blue-800 hover:bg-blue-300';
                }
                menuHtml += `<button onclick="loadLesson(${i})" class="${btnClass}" ${!unlocked ? 'disabled' : ''}>${lessons[i-1].title}${isCompleted ? ' ‚úì' : ''}</button>`;
            }
            menuHtml += '</div>';
            document.getElementById('menuSection').innerHTML = menuHtml;
        }

        function loadLesson(lessonNum) {
            currentLesson = lessonNum;
            localStorage.setItem('currentLesson', currentLesson);
            const lesson = lessons[lessonNum - 1];
            let materialsHtml = `
                <section class="bg-white p-6 rounded-lg shadow-md mb-6 dark:bg-gray-800 dark:text-gray-100">
                    <h2 class="text-2xl font-semibold mb-4">${lesson.vocabTitle}</h2>
                    <ul class="space-y-2 list-disc list-inside">
                        ${lesson.vocab.map(v => `<li><strong>${v.viet} - ${v.thai}</strong>: ${v.eng} <br><em>C√°ch ƒë·ªçc: ${v.pron}</em></li>`).join('')}
                    </ul>
                </section>
                <section class="bg-white p-6 rounded-lg shadow-md mb-6 dark:bg-gray-800 dark:text-gray-100">
                    <h2 class="text-2xl font-semibold mb-4">${lesson.phrasesTitle}</h2>
                    <ul class="space-y-4 list-none p-0">
                        ${lesson.phrases.map(p => `
                            <li>
                                <strong>${p.viet} - ${p.thai}</strong> <br>
                                <em>C√°ch ƒë·ªçc: ${p.pron}</em> <br>
                                <button class="text-blue-600 hover:underline px-0 play-audio" data-audio="${p.audio}" aria-label="Ph√°t √¢m thanh c√¢u ${p.viet}">Nghe √¢m thanh - ‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á</button>
                                <button class="text-gray-600 hover:underline px-2 pause-audio hidden" data-audio="${p.audio}" aria-label="T·∫°m d·ª´ng √¢m thanh c√¢u ${p.viet}">T·∫°m d·ª´ng - ‡∏´‡∏¢‡∏∏‡∏î</button>
                            </li>
                        `).join('')}
                    </ul>
                </section>
            `;
            document.getElementById('lessonMaterials').innerHTML = materialsHtml;
            attachAudioListeners();
            quizData = lesson.quizData;
            loadQuestion();
            loadMenu();
        }

        function loadQuestion() {
            const qKey = getKey(KEY_Q);
            const sKey = getKey(KEY_S);
            const aKey = getKey(KEY_A);
            currentQuestion = parseInt(localStorage.getItem(qKey), 10) || 0;
            score = parseInt(localStorage.getItem(sKey), 10) || 0;
            userAnswers = JSON.parse(localStorage.getItem(aKey)) || {};

            resultEl.textContent = '';
            explanationEl.textContent = '';
            submitBtn.style.display = 'none';
            restartBtn.style.display = 'none';
            playQuestionAudio.classList.add('hidden');
            const q = quizData[currentQuestion];
            questionEl.textContent = `C√¢u ${currentQuestion + 1}/${quizData.length}: ${q.question}`;
            questionEl.classList.remove('question-active');
            questionEl.classList.add('question-enter');
            optionsEl.innerHTML = '';

            if (q.audio) {
                playQuestionAudio.classList.remove('hidden');
                playQuestionAudio.setAttribute('data-audio', q.audio);
            }

            setTimeout(() => {
                questionEl.classList.remove('question-enter');
                questionEl.classList.add('question-active');
            }, 10);

            q.options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.type = 'button';
                btn.className = 'option-btn block w-full text-left p-3 border rounded bg-white dark:bg-gray-700 dark:text-gray-100';
                btn.textContent = opt;
                btn.dataset.value = opt;
                btn.setAttribute('aria-label', `L·ª±a ch·ªçn ${opt}`);
                btn.addEventListener('click', () => handleSelect(btn, q.answer, q.audio, q.explanation));
                if (userAnswers[currentQuestion] === opt) {
                    btn.dataset.selected = 'true';
                    btn.disabled = true;
                    btn.classList.add(opt === q.answer ? 'border-green-300' : 'border-red-300');
                }
                optionsEl.appendChild(btn);
            });

            if (userAnswers[currentQuestion]) {
                submitBtn.style.display = 'inline-block';
                submitBtn.textContent = currentQuestion < quizData.length - 1 ? 'C√¢u ti·∫øp theo - ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏õ' : 'Ho√†n th√†nh - ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô';
                resultEl.innerHTML = userAnswers[currentQuestion] === q.answer
                    ? '<span class="correct">ƒê√∫ng r·ªìi! - ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!</span>'
                    : `<span class="incorrect">Sai r·ªìi! C√¢u tr·∫£ l·ªùi ƒë√∫ng l√†: ${q.answer} - ‡∏ú‡∏¥‡∏î! ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏≠: ${q.answer}</span>`;
                explanationEl.textContent = q.explanation || '';
            }

            updateProgressBar();
            attachAudioListeners();
        }

        function handleSelect(button, correctAnswer, audioUrl, explanation) {
            if (optionsEl.querySelector('[data-selected="true"]')) return;

            button.dataset.selected = 'true';
            userAnswers[currentQuestion] = button.dataset.value;
            localStorage.setItem(getKey(KEY_A), JSON.stringify(userAnswers));

            Array.from(optionsEl.children).forEach(b => {
                b.disabled = true;
                const val = b.dataset.value;
                if (val === correctAnswer) {
                    b.classList.add('border-green-300', 'correct');
                }
            });

            if (button.dataset.value === correctAnswer) {
                score++;
                localStorage.setItem(getKey(KEY_S), String(score));
                resultEl.innerHTML = '<span class="correct">ƒê√∫ng r·ªìi! - ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!</span>';
                if (audioUrl) {
                    audioPlayer.src = audioUrl;
                    audioPlayer.play().catch(() => console.warn('Kh√¥ng th·ªÉ ph√°t √¢m thanh'));
                }
                if (navigator.vibrate) navigator.vibrate(200);
            } else {
                resultEl.innerHTML = `<span class="incorrect">Sai r·ªìi! C√¢u tr·∫£ l·ªùi ƒë√∫ng l√†: ${correctAnswer} - ‡∏ú‡∏¥‡∏î! ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏≠: ${correctAnswer}</span>`;
                button.classList.add('border-red-300', 'incorrect');
                if (navigator.vibrate) navigator.vibrate([100, 50, 100]);
            }

            explanationEl.textContent = explanation || '';
            submitBtn.style.display = 'inline-block';
            submitBtn.textContent = currentQuestion < quizData.length - 1 ? 'C√¢u ti·∫øp theo - ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏õ' : 'Ho√†n th√†nh - ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô';
            submitBtn.focus();
        }

        submitBtn.addEventListener('click', () => {
            if (currentQuestion < quizData.length - 1) {
                currentQuestion++;
                localStorage.setItem(getKey(KEY_Q), String(currentQuestion));
                loadQuestion();
            } else {
                showResults();
            }
        });

        restartBtn.addEventListener('click', resetCurrentQuiz);

        function showResults() {
            const total = quizData.length;
            let completedLessons = JSON.parse(localStorage.getItem('completedLessons')) || [];
            if (!completedLessons.includes(currentLesson)) {
                completedLessons.push(currentLesson);
                localStorage.setItem('completedLessons', JSON.stringify(completedLessons));
            }
            loadMenu();
            let resultsHtml = `
                <p class="text-xl font-semibold mb-2">B·∫°n ƒë√£ ho√†n th√†nh b√†i ki·ªÉm tra! - ‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!</p>
                <p class="mb-4">ƒêi·ªÉm s·ªë: ${score}/${total} - ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${score}/${total}</p>
                <div>
                    <button id="playAgain" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">L√†m l·∫°i b√†i ki·ªÉm tra - ‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà</button>
            `;
            if (currentLesson < lessons.length) {
                resultsHtml += `<button id="nextLesson" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 ml-2">B√†i ti·∫øp theo - ‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>`;
            }
            resultsHtml += `
                </div>
            `;
            document.getElementById('quiz').innerHTML = resultsHtml;
            localStorage.removeItem(getKey(KEY_Q));
            localStorage.removeItem(getKey(KEY_S));
            localStorage.removeItem(getKey(KEY_A));
            progressInner.style.width = '100%';
            document.getElementById('playAgain').addEventListener('click', resetCurrentQuiz);
            const nextBtn = document.getElementById('nextLesson');
            if (nextBtn) {
                nextBtn.addEventListener('click', () => loadLesson(currentLesson + 1));
            }
        }

        function resetCurrentQuiz() {
            currentQuestion = 0;
            score = 0;
            userAnswers = {};
            localStorage.setItem(getKey(KEY_Q), '0');
            localStorage.setItem(getKey(KEY_S), '0');
            localStorage.setItem(getKey(KEY_A), JSON.stringify({}));
            loadQuestion();
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                const focused = document.activeElement;
                if (focused.classList.contains('option-btn') && !focused.disabled) {
                    focused.click();
                }
            }
        });

        // Lazy load audio
        const audioObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const btn = entry.target;
                    const audioUrl = btn.getAttribute('data-audio');
                    if (audioUrl) {
                        const audio = new Audio();
                        audio.src = audioUrl;
                        audio.preload = 'auto';
                    }
                    audioObserver.unobserve(btn);
                }
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('.play-audio').forEach(btn => {
            audioObserver.observe(btn);
        });

        // Init
        const initCompleted = JSON.parse(localStorage.getItem('completedLessons')) || [];
        if (currentLesson > initCompleted.length + 1) {
            currentLesson = initCompleted.length + 1 || 1;
        }
        loadMenu();
        loadLesson(currentLesson);
    </script>
</body>
</html>
